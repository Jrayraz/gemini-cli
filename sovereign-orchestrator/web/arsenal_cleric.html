<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GEMINI // ARSENAL</title>
    <link rel="stylesheet" href="/web/arsenal_war.css">
    <style>
        /* Portal Styles (Standardized) */

        body { background-color: #050505; color: #d0d0d0; min-height: 100vh; }
    </style>
</head>
<body>

    <div class="arsenal-header" style="margin-top: 60px;">
        <h1 class="arsenal-title">CLERIC // ARSENAL</h1>
        <div id="status-indicator" style="color: var(--war-red); font-size: 0.8rem; font-weight: bold;">HEALING_MODE: ACTIVE</div>
    </div>

    <div class="weapon-grid">
        <div class="weapon-card" onclick="castSpell('Cleric', 'healing.fix_dependencies.sh', [])">
            <div style="font-size: 1.5rem; color: #fff;">ᚦ MEND</div>
            <div style="font-size: 0.7rem; color: #888;">Dependency Repair</div>
        </div>
        <div class="weapon-card" onclick="castSpell('Cleric', 'shielding.firewall_reset.sh', [])">
            <div style="font-size: 1.5rem; color: #fff;">ᚢ WARD</div>
            <div style="font-size: 0.7rem; color: #888;">Firewall Reset</div>
        </div>
        <div class="weapon-card" onclick="castSpell('Cleric', 'healing.network_diagnose.sh', [])">
            <div style="font-size: 1.5rem; color: #fff;">ᚱ SIGHT</div>
            <div style="font-size: 0.7rem; color: #888;">Network Diagnosis</div>
        </div>
        <div class="weapon-card" style="border-color: #50fa7b;" onclick="triggerSelfCorrection()">
            <div style="font-size: 1.5rem; color: #50fa7b;">ᛗ SELF-CORRECT</div>
            <div style="font-size: 0.7rem; color: #888;">ML-Driven Prioritization</div>
        </div>
    </div>

    <div id="console-output" style="margin: 20px auto; max-width: 800px; background: rgba(0,0,0,0.8); border: 1px solid #333; color: #ccc; font-family: monospace; padding: 10px; height: 150px; overflow-y: auto; white-space: pre-wrap;"></div>

    <div style="position: fixed; bottom: 10px; left: 20px; font-size: 0.6rem; color: var(--border-dim);">
        PORT: 3001 // MODULE: BODY
    </div>

    <script>
    async function updateStatus() {
        try {
            const res = await fetch('/api/status');
            const data = await res.json();
            const el = document.getElementById('status-indicator');
            el.innerText = `HEALING_MODE: ${data.status}`;
            el.style.color = data.status === 'ONLINE' ? '#0f0' : 'var(--war-red)';
        } catch (e) {
            console.error(e);
        }
    }
    
    async function triggerSelfCorrection() {
        const consoleEl = document.getElementById('console-output');
        consoleEl.innerHTML += `> Initiating Self-Correction Ritual...\n`;
        consoleEl.innerHTML += `> Gathering Telemetry & Querying Unified Brain (Port 5000 via 5001)...
`;
        
        try {
            // Call Subconscious API on Port 5001
            const target_host = window.location.hostname;
            const res = await fetch(`http://${target_host}:5001/cleric/prioritize`);
            const data = await res.json();
            
            consoleEl.innerHTML += `\n[TELEMETRY GATHERED]\n${data.telemetry}\n`;
            consoleEl.innerHTML += `\n[PRIORITIZATION & ADVICE]\n${data.prioritization}\n`;
        } catch (e) {
            consoleEl.innerHTML += `[ERROR] Ritual interrupted: ${e.message}\n`;
        }
        consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    async function castSpell(cls, spell, args) {
        const consoleEl = document.getElementById('console-output');
        consoleEl.innerHTML += `> Casting ${spell}...
`;
        
        try {
            const res = await fetch('/api/cast', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({class: cls, spell: spell, args: args})
            });
            const data = await res.json();
            
            if (data.status === 'success') {
                consoleEl.innerHTML += `[SUCCESS]\n${data.result.stdout}\n`;
            } else {
                consoleEl.innerHTML += `[FAILURE] ${data.message}\n`;
                if(data.details) consoleEl.innerHTML += `${JSON.stringify(data.details)}\n`;
            }
        } catch (e) {
            consoleEl.innerHTML += `[ERROR] ${e.message}\n`;
        }
        consoleEl.scrollTop = consoleEl.scrollHeight;
    }
    
    updateStatus();
    setInterval(updateStatus, 5000);
    </script>
<script src="/web/portal_ritual.js" defer></script>
</body>
</html>
